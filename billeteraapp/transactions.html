<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Últimos Movimientos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style> body { background-color: #f8f9fa; padding-top: 20px; } </style>
</head>
<body>

<div class="container" style="max-width: 600px;">
  <div class="card shadow border-0 rounded-4">
    <div class="card-header bg-white pt-3">
      <h3 class="fw-bold">Historial</h3>

      <!-- Filtro por tipo -->
      <div class="mt-3">
        <label class="small text-muted">Filtrar por:</label>
        <select id="filterType" class="form-select">
          <option value="todos">Todos los movimientos</option>
          <option value="deposito">Depósitos</option>
          <option value="transferencia">Transferencias Enviadas</option>
          <option value="compra">Compras / Pagos</option>
        </select>
      </div>
    </div>

    <div class="list-group list-group-flush" id="transactionsContainer">
      <!-- Se llena dinámicamente -->
    </div>

    <div class="card-body p-3">
      <a href="menu.html" class="btn btn-outline-dark w-100 rounded-pill">Volver al Menú</a>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
    // 1. Cargar Transacciones del Storage
    // Si no hay, usamos una lista ficticia base para que no se vea vacío el ejemplo
    let rawData = localStorage.getItem('walletTransactions');
    let listaTransacciones = rawData ? JSON.parse(rawData) : [
      { tipo: 'compra', descripcion: 'Supermercado Disco', monto: 15200, fecha: '10/11/2023' },
      { tipo: 'deposito', descripcion: 'Sueldo', monto: 150000, fecha: '01/11/2023' },
      { tipo: 'transferencia', descripcion: 'Alquiler', monto: 45000, fecha: '05/11/2023' }
    ];

    // 2. Función para traducir el tipo a texto legible
    function getTipoTransaccion(tipo) {
      if(tipo === 'deposito') return 'Ingreso de Dinero';
      if(tipo === 'transferencia') return 'Transferencia Enviada';
      if(tipo === 'compra') return 'Pago / Compra';
      return 'Movimiento';
    }

    // 3. Función principal para renderizar
    function mostrarUltimosMovimientos(filtro) {
      const container = $('#transactionsContainer');
      container.empty(); // Limpiar lista anterior

      // Filtrar array
      const filtrados = listaTransacciones.filter(t => filtro === 'todos' || t.tipo === filtro);

      if(filtrados.length === 0) {
        container.html('<div class="p-4 text-center text-muted">No hay movimientos en esta categoría.</div>');
        return;
      }

      // Generar HTML
      filtrados.forEach(t => {
        const isPositive = t.tipo === 'deposito';
        const colorClass = isPositive ? 'text-success' : 'text-danger';
        const symbol = isPositive ? '+' : '-';

        const html = `
                        <div class="list-group-item d-flex justify-content-between align-items-center py-3">
                            <div>
                                <h6 class="mb-0 fw-bold">${t.descripcion}</h6>
                                <small class="text-muted">${getTipoTransaccion(t.tipo)} | ${t.fecha}</small>
                            </div>
                            <span class="fs-5 fw-bold ${colorClass}">
                                ${symbol} $${parseFloat(t.monto).toLocaleString()}
                            </span>
                        </div>
                    `;
        container.append(html);
      });
    }

    // 4. Inicializar vista
    mostrarUltimosMovimientos('todos');

    // 5. Evento cambio de filtro
    $('#filterType').change(function() {
      const tipoSeleccionado = $(this).val();
      mostrarUltimosMovimientos(tipoSeleccionado);
    });
  });
</script>
</body>
</html>
